<map name="image-map">
    <!-- Agregar áreas aquí -->
</map>

<div style="position: relative; width: 100%;">
    <img id="responsive-image" src="" usemap="#image-map" style="width: 100%; height: auto; display: block;">
    
    <!-- Contenedor donde se generarán las cajas dinámicamente -->
    <div id="clickable-container"></div>
    
    <!-- Tooltip mejorado -->
    <div id="tooltip" style="display: none;">
        <span id="close-tooltip">&times;</span>
        <img id="tooltip-image" src="" alt="">
        <p id="tooltip-text"></p>
    </div>
</div>

<style>
    .clickable-box {
        position: absolute;
        background: rgba(245, 2, 2, 0.5); 
        text-decoration: none;
        display: block;
    }

    #tooltip {
        position: fixed;
        background: rgba(255, 255, 255, 0.9);
        border-radius: 8px;
        padding: 15px;
        box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.2);
        display: flex;
        flex-direction: column;
        align-items: center;
        max-width: 300px;
        text-align: center;
        z-index: 1000;
        cursor: pointer;
    }

    #tooltip img {
        width: 100px;
        height: auto;
        border-radius: 5px;
    }

    #tooltip p {
        font-family: 'Roboto', sans-serif;
        margin: 10px 0 0;
        font-size: 16px;
    }

    #close-tooltip {
        position: absolute;
        top: 5px;
        right: 10px;
        cursor: pointer;
        font-size: 20px;
        font-weight: bold;
    }
</style>

<script>
    var origWidth = 2560;
    var origHeight = 1820;

    function getAreasData() {
        var areas = document.querySelectorAll("map[name='image-map'] area");
        var areasData = [];

        areas.forEach(area => {
            var coords = area.coords.split(',').map(Number);
            var xCoords = [coords[0], coords[2]].sort((a, b) => a - b);
            var yCoords = [coords[1], coords[3]].sort((a, b) => a - b);
            coords = [xCoords[0], yCoords[0], xCoords[1], yCoords[1]];

            areasData.push({
                href: area.href,
                coords: coords,
                title: area.title,
                imgSrc: area.alt
            });
        });
        return areasData;
    }

    function createBoxes() {
        var container = document.getElementById("clickable-container");
        container.innerHTML = "";
        var areasData = getAreasData();

        areasData.forEach((area, index) => {
            var box = document.createElement("a");
            box.href = area.href;
            box.className = "clickable-box";
            box.id = "box" + index;
            box.dataset.title = area.title;
            box.dataset.imgSrc = area.imgSrc;
            box.dataset.href = area.href;
            container.appendChild(box);

            box.addEventListener("click", function(event) {
                event.preventDefault();
                var tooltip = document.getElementById("tooltip");
                document.getElementById("tooltip-image").src = this.dataset.imgSrc;
                document.getElementById("tooltip-text").innerText = this.dataset.title;
                tooltip.style.display = "block";
                tooltip.style.left = event.clientX + "px";
                tooltip.style.top = event.clientY + "px";
                tooltip.dataset.href = this.dataset.href;
            });
        });
    }

    function resizeElements() {
        var img = document.getElementById("responsive-image");
        var scaleX = img.clientWidth / origWidth;
        var scaleY = (img.clientWidth * (origHeight / origWidth)) / origHeight;

        var areasData = getAreasData();

        areasData.forEach((area, index) => {
            var box = document.getElementById("box" + index);
            var x1 = area.coords[0] * scaleX;
            var y1 = area.coords[1] * scaleY;
            var x2 = area.coords[2] * scaleX;
            var y2 = area.coords[3] * scaleY;

            box.style.left = x1 + "px";
            box.style.top = y1 + "px";
            box.style.width = (x2 - x1) + "px";
            box.style.height = (y2 - y1) + "px";
        });
    }

    document.addEventListener("DOMContentLoaded", function() {
        createBoxes();
        resizeElements();
        window.addEventListener("resize", resizeElements);
    });

    document.getElementById("close-tooltip").addEventListener("click", function() {
        document.getElementById("tooltip").style.display = "none";
    });

    document.addEventListener("click", function(event) {
        var tooltip = document.getElementById("tooltip");
        if (!tooltip.contains(event.target) && !event.target.classList.contains("clickable-box")) {
            tooltip.style.display = "none";
        }
    });

    document.getElementById("tooltip").addEventListener("click", function() {
        if (this.dataset.href) {
            window.open(this.dataset.href, "_blank");
        }
    });
</script>
